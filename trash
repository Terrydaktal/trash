#!/bin/bash

# --- CONFIGURATION ---
TRASH_DIR="/trash"
mkdir -p "$TRASH_DIR"

files_to_trash=()
force=false
use_real_rm=false

# --- 1. PARSE ARGUMENTS ---
for arg in "$@"; do
    case "$arg" in
        --help|--version) use_real_rm=true; break ;;
        -f|--force) force=true ;;
        -i|-v|-I|--interactive|--verbose) continue ;; 
        -r|-R|--recursive) continue ;;                
        -*) use_real_rm=true; break ;;                
        *) files_to_trash+=("$arg") ;;
    esac
done

# If flags like --help were used, or no files given, pass through to real rm
if [ "$use_real_rm" = true ] || [ ${#files_to_trash[@]} -eq 0 ]; then
    exec /bin/rm "$@"
fi

# --- 2. MOVE TO TRASH ---
for file in "${files_to_trash[@]}"; do
    # Check if source file exists
    if [ ! -e "$file" ]; then
        # Only print error if force (-f) is NOT used
        if [ "$force" = false ]; then
            echo "rm: cannot remove '$file': No such file or directory"
        fi
        continue
    fi

    # Get the filename
    base_name="${file##*/}"
    
    # Check for name collision in trash
    if [ -e "$TRASH_DIR/$base_name" ]; then
        # Conflict: Add random suffix
        random_suffix=$(mktemp -u XXXXXXXXXXXX)
        mv "$file" "$TRASH_DIR/${base_name}-${random_suffix}"
    else
        # No Conflict: Move cleanly
        mv "$file" "$TRASH_DIR/"
    fi
done
